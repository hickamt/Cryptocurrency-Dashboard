import { render, waitFor, screen } from "@testing-library/react";
import HistoricalLineChart from "../components/chart/HistoricalLineChart";
import lcwSingleHistory from "../api/lcwHistoricalAPI";

const cryptoDataMock = {
  code: "BTC",
  name: "Bitcoin",
  symbol: "â‚¿",
  rank: 1,
  age: 5427,
  color: "#fa9e32",
  png32:
    "https://lcw.nyc3.cdn.digitaloceanspaces.com/production/currencies/32/btc.png",
  png64:
    "https://lcw.nyc3.cdn.digitaloceanspaces.com/production/currencies/64/btc.png",
  webp32:
    "https://lcw.nyc3.cdn.digitaloceanspaces.com/production/currencies/32/btc.webp",
  webp64:
    "https://lcw.nyc3.cdn.digitaloceanspaces.com/production/currencies/64/btc.webp",
  exchanges: 191,
  markets: 3394,
  pairs: 1042,
  categories: [],
  allTimeHighUSD: 68780.77475755227,
  circulatingSupply: 19540856,
  totalSupply: 19540856,
  maxSupply: 21000000,
  links: {
    website: "https://bitcoin.org/",
    whitepaper: "https://bitcoin.org/bitcoin.pdf",
    twitter: null,
    reddit: "https://reddit.com/r/bitcoin",
    telegram: null,
    discord: null,
    medium: null,
    instagram: null,
  },
  history: [
    {
      date: 1699473000000,
      rate: 35707.375578530045,
      volume: 10804557185,
      cap: 697608747887,
      liquidity: 974290172,
    },
    {
      date: 1699473900000,
      rate: 35688.192119086314,
      volume: 11015658210,
      cap: 697233963997,
      liquidity: 975928188,
    },
    {
      date: 1699474800000,
      rate: 35802.235418544624,
      volume: 10895867949,
      cap: 699462007981,
      liquidity: 973743401,
    },
    {
      date: 1699475700000,
      rate: 35692.14658874893,
      volume: 10899161100,
      cap: 697311221779,
      liquidity: 968664876,
    },
    {
      date: 1699476600000,
      rate: 35620.17482020259,
      volume: 10949316397,
      cap: 695905121932,
      liquidity: 988664252,
    },
    {
      date: 1699477500000,
      rate: 35669.37818756879,
      volume: 10582027075,
      cap: 696866399509,
      liquidity: 981260438,
    },
    {
      date: 1699478400000,
      rate: 35670.22255660042,
      volume: 10812934309,
      cap: 696882895799,
      liquidity: 960232312,
    },
    {
      date: 1699479300000,
      rate: 35503.489108589725,
      volume: 10799877219,
      cap: 693628755428,
      liquidity: 963316013,
    },
    {
      date: 1699480200000,
      rate: 35499.90642064535,
      volume: 10876743546,
      cap: 693558760748,
      liquidity: 959986751,
    },
    {
      date: 1699481100000,
      rate: 35632.11859044006,
      volume: 10901752055,
      cap: 696141779068,
      liquidity: 994697721,
    },
    {
      date: 1699482000000,
      rate: 35875.94791829028,
      volume: 11022569366,
      cap: 700905452652,
      liquidity: 965652583,
    },
    {
      date: 1699482900000,
      rate: 35881.21729914946,
      volume: 11182822569,
      cap: 701008400114,
      liquidity: 1002686367,
    },
    {
      date: 1699483800000,
      rate: 35773.3175199595,
      volume: 11172551374,
      cap: 698900370975,
      liquidity: 998340385,
    },
    {
      date: 1699484700000,
      rate: 35846.524925366386,
      volume: 11163384523,
      cap: 700330618052,
      liquidity: 1006044456,
    },
    {
      date: 1699485600000,
      rate: 35810.41335610245,
      volume: 11176137922,
      cap: 699625109284,
      liquidity: 995665433,
    },
    {
      date: 1699486500000,
      rate: 35890.51118015037,
      volume: 11204103203,
      cap: 701189973905,
      liquidity: 990837835,
    },
    {
      date: 1699487400000,
      rate: 35934.19849271736,
      volume: 11286124748,
      cap: 702043489348,
      liquidity: 964797584,
    },
    {
      date: 1699488300000,
      rate: 35697.448055209206,
      volume: 11776789758,
      cap: 697418115464,
      liquidity: 948786082,
    },
    {
      date: 1699489200000,
      rate: 35719.51598620565,
      volume: 11922751789,
      cap: 697849254822,
      liquidity: 962108850,
    },
    {
      date: 1699490100000,
      rate: 35763.58742997202,
      volume: 11983659681,
      cap: 698712957274,
      liquidity: 970412661,
    },
    {
      date: 1699491000000,
      rate: 35899.74933982753,
      volume: 12054650444,
      cap: 701373151554,
      liquidity: 948949505,
    },
    {
      date: 1699491900000,
      rate: 35901.86299581919,
      volume: 12161865796,
      cap: 701414446036,
      liquidity: 978276247,
    },
    {
      date: 1699492800000,
      rate: 35852.00649582988,
      volume: 12158423790,
      cap: 700440399945,
      liquidity: 973825350,
    },
    {
      date: 1699493700000,
      rate: 35931.54985967152,
      volume: 12248194467,
      cap: 701994438088,
      liquidity: 998312497,
    },
    {
      date: 1699494600000,
      rate: 35973.004386157816,
      volume: 12338141315,
      cap: 702804334881,
      liquidity: 951893412,
    },
    {
      date: 1699495500000,
      rate: 35979.94391695336,
      volume: 12554464094,
      cap: 702939912446,
      liquidity: 953923892,
    },
    {
      date: 1699496400000,
      rate: 36055.78034434343,
      volume: 12644026709,
      cap: 704421528197,
      liquidity: 971355758,
    },
    {
      date: 1699497300000,
      rate: 36409.70636796067,
      volume: 13475518941,
      cap: 711336178443,
      liquidity: 915117316,
    },
    {
      date: 1699498200000,
      rate: 36423.6092205471,
      volume: 13842537896,
      cap: 711607798377,
      liquidity: 942792202,
    },
    {
      date: 1699499100000,
      rate: 36394.17162025823,
      volume: 14039358792,
      cap: 711032676186,
      liquidity: 989222055,
    },
    {
      date: 1699500000000,
      rate: 36361.07720342541,
      volume: 14099658149,
      cap: 710386110796,
      liquidity: 978434483,
    },
    {
      date: 1699500900000,
      rate: 36498.89652386091,
      volume: 14289320298,
      cap: 713083248256,
      liquidity: 974651846,
    },
    {
      date: 1699501800000,
      rate: 36532.35723934572,
      volume: 14376942597,
      cap: 713736974203,
      liquidity: 985300557,
    },
    {
      date: 1699502700000,
      rate: 36458.40511002341,
      volume: 14563532601,
      cap: 712292162726,
      liquidity: 977997668,
    },
    {
      date: 1699503600000,
      rate: 36561.16315788682,
      volume: 14676698300,
      cap: 714299758833,
      liquidity: 992224360,
    },
    {
      date: 1699504500000,
      rate: 36622.16398067386,
      volume: 14922804498,
      cap: 715491539106,
      liquidity: 1000520399,
    },
    {
      date: 1699505400000,
      rate: 36787.6918790533,
      volume: 15279375753,
      cap: 718725477189,
      liquidity: 989163247,
    },
    {
      date: 1699506300000,
      rate: 36760.28281690375,
      volume: 15459468517,
      cap: 718189983107,
      liquidity: 991477218,
    },
    {
      date: 1699507200000,
      rate: 36649.76949493959,
      volume: 15593855925,
      cap: 716030871295,
      liquidity: 1007214476,
    },
    {
      date: 1699508100000,
      rate: 36584.50484236287,
      volume: 15625308173,
      cap: 714755788077,
      liquidity: 1027656615,
    },
    {
      date: 1699509000000,
      rate: 36648.758487859974,
      volume: 15705456596,
      cap: 716011119131,
      liquidity: 991290595,
    },
    {
      date: 1699509900000,
      rate: 36633.43554048553,
      volume: 15804569960,
      cap: 715711752900,
      liquidity: 1005354330,
    },
    {
      date: 1699510800000,
      rate: 36753.68402705798,
      volume: 15873895814,
      cap: 718061061771,
      liquidity: 1016776486,
    },
    {
      date: 1699511700000,
      rate: 36746.73932493238,
      volume: 15963414474,
      cap: 717929056980,
      liquidity: 1021991510,
    },
    {
      date: 1699512600000,
      rate: 36796.41596045714,
      volume: 16026514094,
      cap: 718899600238,
      liquidity: 990449049,
    },
    {
      date: 1699513500000,
      rate: 36796.2984739096,
      volume: 16110263555,
      cap: 718897304878,
      liquidity: 983017554,
    },
    {
      date: 1699514400000,
      rate: 36718.10790377025,
      volume: 16166480005,
      cap: 717369678663,
      liquidity: 1020175990,
    },
    {
      date: 1699515300000,
      rate: 36785.23988241885,
      volume: 16280721756,
      cap: 718681250765,
      liquidity: 1014155634,
    },
    {
      date: 1699516200000,
      rate: 36652.42283948174,
      volume: 16440943158,
      cap: 716086375243,
      liquidity: 999040079,
    },
    {
      date: 1699517100000,
      rate: 36607.266857006,
      volume: 16495130456,
      cap: 715204152970,
      liquidity: 1003521137,
    },
    {
      date: 1699518000000,
      rate: 36690.336030086844,
      volume: 16541506080,
      cap: 716827093513,
      liquidity: 1022790143,
    },
    {
      date: 1699518900000,
      rate: 36660.26129099567,
      volume: 16594563845,
      cap: 716239516779,
      liquidity: 1011248553,
    },
    {
      date: 1699519800000,
      rate: 36677.10388352181,
      volume: 16646873068,
      cap: 716568574181,
      liquidity: 1018326517,
    },
    {
      date: 1699520700000,
      rate: 36735.13530013485,
      volume: 16695309582,
      cap: 717702346618,
      liquidity: 1023616000,
    },
    {
      date: 1699521600000,
      rate: 36710.89126084156,
      volume: 16686868395,
      cap: 717228685537,
      liquidity: 1026981270,
    },
    {
      date: 1699522500000,
      rate: 36753.77635859689,
      volume: 16764552085,
      cap: 718070473695,
      liquidity: 1030192623,
    },
    {
      date: 1699523400000,
      rate: 36841.941517539744,
      volume: 16935994849,
      cap: 719792985059,
      liquidity: 1025296974,
    },
    {
      date: 1699524300000,
      rate: 36882.68328623402,
      volume: 17019155266,
      cap: 720588970235,
      liquidity: 1027228510,
    },
    {
      date: 1699525200000,
      rate: 36862.03642726193,
      volume: 17126498268,
      cap: 720185585841,
      liquidity: 1051004174,
    },
    {
      date: 1699526100000,
      rate: 36859.82121833645,
      volume: 17376023896,
      cap: 720142306585,
      liquidity: 1020444898,
    },
    {
      date: 1699527000000,
      rate: 36863.8143918362,
      volume: 17502053963,
      cap: 720220322513,
      liquidity: 1036487809,
    },
    {
      date: 1699527900000,
      rate: 36844.247481879625,
      volume: 17560944343,
      cap: 719838037434,
      liquidity: 1046596084,
    },
    {
      date: 1699528800000,
      rate: 36741.82316698062,
      volume: 17546078276,
      cap: 717836940306,
      liquidity: 1037889740,
    },
    {
      date: 1699529700000,
      rate: 36798.48471502874,
      volume: 17649287151,
      cap: 718943955385,
      liquidity: 1041485467,
    },
    {
      date: 1699530600000,
      rate: 36815.23940266591,
      volume: 17684251345,
      cap: 719271297163,
      liquidity: 1028784979,
    },
    {
      date: 1699531500000,
      rate: 36870.007162190865,
      volume: 17780478827,
      cap: 720341312680,
      liquidity: 1028852434,
    },
    {
      date: 1699532400000,
      rate: 36897.7402635598,
      volume: 17860921386,
      cap: 720883143295,
      liquidity: 1025359779,
    },
    {
      date: 1699533300000,
      rate: 36997.71727525296,
      volume: 18057442463,
      cap: 722839201494,
      liquidity: 1023042283,
    },
    {
      date: 1699534200000,
      rate: 36988.01991405256,
      volume: 18200880368,
      cap: 722649740269,
      liquidity: 1017443423,
    },
    {
      date: 1699535100000,
      rate: 36956.315963790476,
      volume: 18477781064,
      cap: 722030327511,
      liquidity: 1020777906,
    },
    {
      date: 1699536000000,
      rate: 36960.06806096801,
      volume: 18548369145,
      cap: 722103633734,
      liquidity: 989619961,
    },
    {
      date: 1699536900000,
      rate: 36971.960310996896,
      volume: 18628276239,
      cap: 722335977380,
      liquidity: 1012158626,
    },
    {
      date: 1699537800000,
      rate: 36942.355813224334,
      volume: 18774228566,
      cap: 721757582465,
      liquidity: 1006784562,
    },
    {
      date: 1699538700000,
      rate: 37170.202077507114,
      volume: 19246947465,
      cap: 726209106069,
      liquidity: 1037341192,
    },
    {
      date: 1699539600000,
      rate: 37632.09007571056,
      volume: 20395199330,
      cap: 735233196645,
      liquidity: 938374560,
    },
    {
      date: 1699540500000,
      rate: 37566.19693094987,
      volume: 20935412400,
      cap: 733945815919,
      liquidity: 944480759,
    },
    {
      date: 1699541400000,
      rate: 37698.414019499796,
      volume: 21303929952,
      cap: 736528994065,
      liquidity: 967654544,
    },
    {
      date: 1699542300000,
      rate: 37917.10927652624,
      volume: 22159487129,
      cap: 740801730779,
      liquidity: 947930407,
    },
    {
      date: 1699543200000,
      rate: 37730.615221763685,
      volume: 22839113752,
      cap: 737158121834,
      liquidity: 899943948,
    },
    {
      date: 1699544100000,
      rate: 37302.03477505387,
      volume: 23213522246,
      cap: 728789175854,
      liquidity: 873370759,
    },
    {
      date: 1699545000000,
      rate: 37443.31702490587,
      volume: 23681829957,
      cap: 731549480354,
      liquidity: 925132772,
    },
    {
      date: 1699545900000,
      rate: 37152.59991493459,
      volume: 23921485073,
      cap: 725869589585,
      liquidity: 893566905,
    },
    {
      date: 1699546800000,
      rate: 36483.856474737346,
      volume: 23990016174,
      cap: 712804002585,
      liquidity: 728363720,
    },
    {
      date: 1699547700000,
      rate: 36582.95604341816,
      volume: 24870987511,
      cap: 714740162191,
      liquidity: 783286311,
    },
    {
      date: 1699548600000,
      rate: 36307.93184839548,
      volume: 25692200272,
      cap: 709366872031,
      liquidity: 765185710,
    },
    {
      date: 1699549500000,
      rate: 36465.68916564735,
      volume: 26223828772,
      cap: 712449058456,
      liquidity: 850237720,
    },
    {
      date: 1699550400000,
      rate: 36360.693675269744,
      volume: 26315375561,
      cap: 710397707173,
      liquidity: 859539762,
    },
    {
      date: 1699551300000,
      rate: 36238.41896154752,
      volume: 26536895256,
      cap: 708008762753,
      liquidity: 888522015,
    },
    {
      date: 1699552200000,
      rate: 36451.26012974577,
      volume: 26815353025,
      cap: 712167150908,
      liquidity: 897620360,
    },
    {
      date: 1699553100000,
      rate: 36695.16428554622,
      volume: 27218664191,
      cap: 716932432742,
      liquidity: 912039481,
    },
    {
      date: 1699554000000,
      rate: 36517.96884652756,
      volume: 27180133098,
      cap: 713470473662,
      liquidity: 925554181,
    },
    {
      date: 1699554900000,
      rate: 36412.25005021668,
      volume: 27167082707,
      cap: 711409105361,
      liquidity: 925741269,
    },
    {
      date: 1699555800000,
      rate: 36492.25604068873,
      volume: 27294066998,
      cap: 712972232880,
      liquidity: 918297719,
    },
    {
      date: 1699556700000,
      rate: 36460.28539313459,
      volume: 27213123098,
      cap: 712347602166,
      liquidity: 885810220,
    },
    {
      date: 1699557600000,
      rate: 36359.268041518575,
      volume: 27063898077,
      cap: 710373962425,
      liquidity: 900732031,
    },
    {
      date: 1699558500000,
      rate: 36363.67176431557,
      volume: 27089818596,
      cap: 710460000736,
      liquidity: 914844542,
    },
    {
      date: 1699559400000,
      rate: 36271.098735977335,
      volume: 27083360125,
      cap: 708651343068,
      liquidity: 898870609,
    },
  ],
};

jest.mock("../api/lcwHistoricalAPI");

describe("HistoricalLineChart", () => {
  beforeEach(() => {
    // Mock the API calls
    lcwSingleHistory.mockResolvedValue(cryptoDataMock);
  });
  it("renders without crashing", () => {
    render(<HistoricalLineChart />);
    expect(screen.getByText(/Loading.../i)).toBeInTheDocument();
  });

  it("fetches data and updates state correctly", async () => {
    lcwSingleHistory.mockResolvedValueOnce({
      history: [
        { rate: 100, date: "2023-01-01" },
        { rate: 200, date: "2023-01-02" },
      ],
    });

    render(<HistoricalLineChart />);
    await waitFor(() => {
      expect(screen.queryByText(/Loading.../i)).not.toBeInTheDocument();
    });

    expect(screen.getByText(/BTC Price in USD/i)).toBeInTheDocument();
  });
});
